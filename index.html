<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SpetsTeknika Rentals — Demo</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://www.googletagmanager.com https://www.google-analytics.com https://unpkg.com; img-src 'self' data: https:; style-src 'self' 'unsafe-inline'; script-src 'self' https://www.googletagmanager.com https://unpkg.com 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https:; frame-ancestors 'self';">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), interest-cohort=()">
  <meta name="description" content="Heavy equipment rentals with operator. Fast dispatch, safety-first, clear pricing. Get a quote in minutes.">
  <meta property="og:title" content="SpetsTeknika Rentals — Fast, Safe, Clear Pricing">
  <meta property="og:description" content="Book an operator today. Avtovyshka, Avtokran and more.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://your-domain.example/">
  <meta property="og:image" content="https://your-domain.example/assets/og-image.jpg">
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-W5NTT98P');</script>
  <!-- End Google Tag Manager -->
  <script>
    // Minimal gtag shim + CMv2 defaults so GTM/GA4 get consent state
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    // Default = denied (essential only)
    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'analytics_storage': 'denied',
      'functionality_storage': 'granted',
      'security_storage': 'granted'
    });
  </script>

  <script>
    (function(){
      var f = document.getElementById('lead-inline-form');
      if (!f) return;
      f.addEventListener('submit', function(e){
        e.preventDefault();
        var ok = f.form_service.value && f.city.value && f.urgency.value;
        if (!ok) { alert('Please fill required fields.'); return; }
        var msg = document.getElementById('lead-inline-success'); if (msg) msg.style.display = 'block';
        f.reset();
      });
    })();
  </script>

  <style>
    /* Design tokens */
    :root {
      --bg: #0f1222;
      --panel: #151936;
      --text: #e7ecf2;
      --muted: #a8b3c5;
      --brand: #6aa9ff;
      --accent: #37e39f;
      --danger: #ff6a6a;
      --border: #262b51;
      --shadow: 0 6px 24px rgba(0,0,0,0.3);
      --radius: 12px;
      --space: 16px;
      --space-lg: 28px;
      --space-xl: 48px;
      --maxw: 1100px;
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% -10%, #263076 0%, rgba(41,23,133,0.2) 40%, rgba(11,12,17,0) 100%), var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a { color: var(--brand); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .container { width: 100%; max-width: var(--maxw); margin: 0 auto; padding: 0 var(--space); }

    /* Header */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(6px);
      background: rgba(15,18,34,0.6);
      border-bottom: 1px solid var(--border);
    }
    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space);
      padding: 14px 0;
    }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; }
    .brand-badge { width: 36px; height: 36px; border-radius: 8px; background: linear-gradient(135deg, var(--brand), #b3d4ff); box-shadow: var(--shadow); }
    .nav a { color: var(--text); opacity: 0.9; }
    .nav a:hover { opacity: 1; }
    .nav-links { display: flex; gap: 16px; align-items: center; }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 8px; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0));
      color: var(--text); text-decoration: none; box-shadow: var(--shadow);
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      will-change: transform;
    }
    .btn:hover { transform: translateY(-1px); text-decoration: none; }
    .btn-primary { background: linear-gradient(135deg, var(--brand), #3e6ad8); border-color: rgba(255,255,255,0.08); }
    .btn-accent { background: linear-gradient(135deg, var(--accent), #2bbf87); border-color: rgba(255,255,255,0.08); color: #0b1324; }
    .btn-ghost { background: transparent; }

    /* Hero */
    .hero { padding: calc(var(--space-xl) + 8px) 0 var(--space-xl); }
    .hero-wrap { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: var(--space-xl); align-items: center; }
    .eyebrow { display: inline-block; font-size: 12px; letter-spacing: .1em; text-transform: uppercase; color: var(--muted); margin-bottom: 10px; }
    h1 { margin: 0 0 12px; font-size: clamp(28px, 5vw, 44px); line-height: 1.1; }
    .kpis { display: flex; gap: 16px; flex-wrap: wrap; color: var(--muted); margin: 12px 0 18px; }
    .cta-row { display: flex; gap: 12px; flex-wrap: wrap; }
    .hero-card { background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid var(--border); border-radius: var(--radius); padding: var(--space-lg); }

    /* Sections */
    section { padding: var(--space-xl) 0; }
    .section-title { font-size: 22px; margin: 0 0 16px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space); }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.015)); border: 1px solid var(--border); border-radius: var(--radius); padding: var(--space-lg); }
    .card h3 { margin: 0 0 8px; font-size: 18px; }
    .card p { margin: 0 0 12px; color: var(--muted); }

    /* Inline lead form */
    .lead-section form { display: grid; gap: 12px; grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .lead-section form label { display: block; }
    @media (max-width: 900px) { .lead-section form { grid-template-columns: 1fr; } }

    /* FAQ */
    details { border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; background: rgba(255,255,255,0.02); }
    details + details { margin-top: 10px; }
    summary { cursor: pointer; font-weight: 600; }
    summary::-webkit-details-marker { display: none; }

    /* Footer */
    footer { border-top: 1px solid var(--border); padding: var(--space-lg) 0 var(--space-xl); color: var(--muted); }
    .footer-row { display: flex; justify-content: space-between; gap: var(--space); flex-wrap: wrap; }

    /* Cookie banner */
    #cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #11162b;
      color: #fff;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      border-top: 1px solid var(--border);
    }
    #cookie-banner button {
      margin-left: 10px;
      padding: 7px 12px;
      cursor: pointer;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      color: var(--text);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .hero-wrap { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
      .nav-links { display: none; }
    }

    /* Sticky CTA bar (mobile) */
    .sticky-reserve { height: 64px; }
    .sticky-bar {
      position: fixed; left: 0; right: 0; bottom: 0; z-index: 60;
      background: rgba(17,22,43,0.98); border-top: 1px solid var(--border);
      display: none;
    }
    .sticky-inner { display: flex; gap: 10px; align-items: center; justify-content: space-between; padding: 10px var(--space); }
    .sticky-bar .btn { flex: 1; text-align: center; }
    @media (min-width: 901px) { .sticky-bar, .sticky-reserve { display: none !important; } }

    /* Debug overlay */
    #debug-panel { position: fixed; right: 12px; bottom: 76px; width: 300px; max-height: 50vh; overflow: auto; padding: 12px; background: #0d1126; border: 1px solid var(--border); border-radius: 10px; color: var(--text); box-shadow: var(--shadow); display: none; }
    #debug-panel pre { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W5NTT98P"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
     
  <!-- Schema.org JSON-LD: Organization + FAQPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "SpetsTeknika",
    "url": "https://your-domain.example/",
    "logo": "https://your-domain.example/assets/logo.svg",
    "sameAs": ["https://facebook.com/yourpage", "https://www.linkedin.com/company/yourpage"],
    "contactPoint": [{
      "@type": "ContactPoint",
      "telephone": "+1234567890",
      "contactType": "customer service",
      "areaServed": "UA",
      "availableLanguage": ["en","ru","uk"]
    }]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How fast can you arrive?",
        "acceptedAnswer": { "@type": "Answer", "text": "Usually within 2–4 hours in major cities; call for urgent cases." }
      },
      {
        "@type": "Question",
        "name": "Do you include an operator?",
        "acceptedAnswer": { "@type": "Answer", "text": "Yes, all services include a trained operator for safety." }
      },
      {
        "@type": "Question",
        "name": "How do I get pricing?",
        "acceptedAnswer": { "@type": "Answer", "text": "Submit the quick form or call us. We’ll confirm the rate and schedule." }
      }
    ]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://your-domain.example/"}
    ]
  }
  </script>
  
  <header>
    <div class="container nav">
      <div class="brand">
        <span class="brand-badge" aria-hidden="true"></span>
        <span>SpetsTeknika</span>
      </div>
      <nav class="nav-links">
        <a href="#services">Services</a>
        <a href="#proof">Why us</a>
        <a href="#faq">FAQ</a>
        <a href="#contact" class="btn btn-ghost">Contact</a>
        <a href="tel:+1234567890" id="call-btn" data-cta="call_header" class="btn btn-primary js-phone">📞 Call</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container hero-wrap">
        <div>
          <span class="eyebrow">Heavy equipment rentals</span>
          <h1>Fast, safe, and clear pricing — book an operator today</h1>
          <div class="kpis">
            <span>⏱️ Avg. dispatch <strong>2–4h</strong></span>
            <span>🛡️ Safety first</span>
            <span>💬 24/7</span>
          </div>
          <div class="cta-row">
            <a href="#lead" class="btn btn-accent" data-cta="hero_open_form">Get a quote</a>
            <a href="#" class="btn" data-cta="hero_download_price" id="download-price">Price list (PDF)</a>
            <a href="https://wa.me/1234567890" class="btn js-wa" data-cta="hero_whatsapp">WhatsApp</a>
          </div>
        </div>
        <div class="hero-card">
          <strong>Quick request</strong>
          <p style="margin:8px 0 12px;color:var(--muted)">Tell us service, city, and timing. We’ll confirm in minutes.</p>
          <div class="cta-row">
            <a href="#lead" class="btn btn-accent" data-cta="hero_open_form">Open form</a>
            <a href="tel:+1234567890" class="btn">Or call us</a>
          </div>
        </div>
      </div>
    </section>

    <section id="lead-inline" class="lead-section">
      <div class="container">
        <h2 class="section-title">Get a quick quote</h2>
        <form id="lead-inline-form" novalidate>
          <label>Service<br>
            <select name="form_service" required>
              <option value="avtovyshka">Avtovyshka</option>
              <option value="avtokran">Avtokran</option>
            </select>
          </label>
          <label>City<br>
            <input type="text" name="city" placeholder="Kyiv" required>
          </label>
          <label>Budget estimate<br>
            <input type="text" name="budget_estimate" placeholder="$ per hour">
          </label>
          <label>Urgency<br>
            <select name="urgency" required>
              <option value="today">Today</option>
              <option value="48h">48 hours</option>
              <option value="scheduled">Scheduled</option>
            </select>
          </label>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        <p id="lead-inline-success" style="display:none;color:var(--accent);margin-top:8px;">Thank you! We'll contact you shortly.</p>
      </div>
    </section>

    <section id="services">
      <div class="container">
        <h2 class="section-title">Popular services</h2>
        <div class="grid">
          <div class="card">
            <h3>Avtovyshka</h3>
            <p>Bucket truck with operator for access at height.</p>
            <a href="#lead" class="btn" data-cta="svc_avtovyshka">Get quote</a>
          </div>
          <div class="card">
            <h3>Avtokran</h3>
            <p>Mobile crane for lifting and precise placement.</p>
            <a href="#lead" class="btn" data-cta="svc_avtokran">Get quote</a>
          </div>
          <div class="card">
            <h3>Lowboy Transport</h3>
            <p>Heavy haul for oversized cargo and machinery.</p>
            <a href="#lead" class="btn" data-cta="svc_lowboy">Get quote</a>
          </div>
        </div>
      </div>
    </section>

    <section id="proof">
      <div class="container">
        <h2 class="section-title">Why choose us</h2>
        <div class="grid">
          <div class="card"><h3>Speed</h3><p>Dispatch 2–4h in major cities. Live ETA updates.</p><a href="#" class="btn proof-link" data-proof-id="speed_1">See example</a></div>
          <div class="card"><h3>Safety</h3><p>Certified operators. Site safety checklist before lift.</p><a href="#" class="btn proof-link" data-proof-id="safety_1">See example</a></div>
          <div class="card"><h3>Clarity</h3><p>Transparent rates. No hidden fees. Signed service sheets.</p><a href="#" class="btn proof-link" data-proof-id="clarity_1">See example</a></div>
        </div>
      </div>
    </section>

    <section id="faq">
      <div class="container">
        <h2 class="section-title">FAQs</h2>
        <details>
          <summary>How fast can you arrive?</summary>
          <p>Usually within 2–4 hours in major cities; call for urgent cases.</p>
        </details>
        <details>
          <summary>Do you include an operator?</summary>
          <p>Yes, all services include a trained operator for safety.</p>
        </details>
        <details>
          <summary>How do I get pricing?</summary>
          <p>Submit the quick form or call us. We’ll confirm the rate and schedule.</p>
        </details>
      </div>
    </section>
    
    <!-- Estimator (simple) -->
    <section id="estimator">
      <div class="container">
        <h2 class="section-title">Rough estimate</h2>
        <div class="card">
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;">
            <label>Service<br>
              <select id="est_service">
        <option value="avtovyshka">Avtovyshka</option>
        <option value="avtokran">Avtokran</option>
      </select>
            </label>
            <label>Capacity<br>
              <select id="est_capacity">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="heavy">Heavy</option>
      </select>
            </label>
            <label>City<br>
              <input type="text" id="est_city" placeholder="Kyiv">
            </label>
            <div style="display:flex;gap:8px;align-items:flex-end;">
              <button class="btn" data-spec="small">Small</button>
              <button class="btn" data-spec="medium">Medium</button>
              <button class="btn" data-spec="heavy">Heavy</button>
            </div>
          </div>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center;">
            <button class="btn" id="est_calc">Calculate</button>
            <span id="est_result" style="color:var(--muted)"></span>
            <button class="btn btn-accent" id="est_use">Use in form</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer id="contact">
    <div class="container footer-row">
      <span>© <span id="year"></span> SpetsTeknika</span>
      <span>
        <a href="#" id="privacy-link">Privacy</a> ·
        <a href="#" id="consent-settings">Consent settings</a>
        · <button id="forget-me" class="btn btn-ghost" style="padding:4px 8px;">Forget me</button>
      </span>
    </div>
  </footer>

  <!-- Sticky spacer to avoid CLS on mobile -->
  <div class="sticky-reserve"></div>
  <!-- Sticky CTA bar (mobile) -->
  <div class="sticky-bar" id="sticky-bar" aria-hidden="true">
    <div class="sticky-inner container">
      <a href="tel:+1234567890" class="btn btn-primary js-phone" data-cta="sticky_call">📞 Call</a>
      <a href="https://wa.me/1234567890" class="btn js-wa" data-cta="sticky_whatsapp">WhatsApp</a>
      <a href="#lead" class="btn btn-accent" data-cta="sticky_open_form">Get quote</a>
    </div>
  </div>

  <!-- Debug overlay -->
  <div id="debug-panel"><strong>Debug</strong><pre id="debug-pre"></pre></div>

  <!-- Lead Form Modal -->
  <dialog id="lead-modal">
    <form id="lead-form" action="https://example.com/form-handler" method="POST" novalidate>
      <h3 style="margin:0 0 10px;">Request a quote</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <label style="grid-column: span 1;">Name<br>
          <input type="text" name="lead_name" placeholder="Your name" required>
        </label>
        <label style="grid-column: span 1;">Phone<br>
          <input type="tel" name="lead_phone" placeholder="+380XXXXXXXXX" required>
        </label>
        <label style="grid-column: span 1;">Service<br>
          <select name="lead_service" required>
            <option value="avtovyshka">Avtovyshka</option>
            <option value="avtokran">Avtokran</option>
          </select>
        </label>
        <label style="grid-column: span 1;">City<br>
          <input type="text" name="lead_city" placeholder="Kyiv" required>
        </label>
        <label style="grid-column: span 1;">Urgency<br>
          <select name="lead_urgency" required>
        <option value="today">Today</option>
        <option value="48h">48 hours</option>
        <option value="scheduled">Scheduled</option>
      </select>
        </label>
        <label style="grid-column: span 1;">Capacity (optional)<br>
          <select name="required_capacity">
            <option value="">Select</option>
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="heavy">Heavy</option>
          </select>
        </label>
        <label style="grid-column: span 1;">Job type (optional)<br>
          <input type="text" name="job_type" placeholder="e.g., glass install">
        </label>
        <label style="grid-column: span 1;">Budget (optional)<br>
          <input type="text" name="lead_budget_estimate" placeholder="$ per hour">
        </label>
        <label style="grid-column: 1 / -1;">Notes (optional)<br>
          <textarea name="lead_notes" rows="3" placeholder="Any specifics"></textarea>
        </label>
      </div>
    <!-- Hidden UTM fields -->
    <input type="hidden" id="utm_source" name="utm_source">
    <input type="hidden" id="utm_campaign" name="utm_campaign">
      <input type="hidden" id="utm_medium" name="utm_medium">
      <input type="hidden" id="utm_content" name="utm_content">
      <input type="hidden" id="utm_term" name="utm_term">
      <input type="hidden" id="gclid" name="gclid">
      <input type="hidden" id="session_uuid" name="session_uuid">
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
        <button type="button" id="lead-cancel" class="btn">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit request</button>
      </div>
      <!-- Experiments assignment snapshot -->
      <input type="hidden" id="ab_assignments" name="ab_assignments">
  </form>
  </dialog>

  <!-- Script to fill UTMs and small helpers -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const utmKeys = ['utm_source','utm_medium','utm_campaign','utm_content','utm_term','gclid'];
    // session UUID
    function getOrCreateSessionUUID(){
      try {
        var k = 'session_uuid';
        var id = sessionStorage.getItem(k);
        if (!id) {
          id = (crypto && crypto.randomUUID) ? crypto.randomUUID() : 'sess-' + Math.random().toString(36).slice(2) + Date.now();
          sessionStorage.setItem(k, id);
        }
        return id;
      } catch(e) { return 'sess-' + Date.now(); }
    }
    var sessionUUID = getOrCreateSessionUUID();
    // Fill hidden inputs if present and store in sessionStorage for later use
    utmKeys.forEach(function(k){
      var v = params.get(k);
      if (v) {
        sessionStorage.setItem(k, v);
      }
      var el = document.getElementById(k);
      if (el) { el.value = v || sessionStorage.getItem(k) || ''; }
    });
    var sessEl = document.getElementById('session_uuid');
    if (sessEl) sessEl.value = sessionUUID;
    // Year in footer
    var y = document.getElementById('year');
    if (y) { y.textContent = new Date().getFullYear(); }
    // File download tracking for price list
    var price = document.getElementById('download-price');
    if (price) {
      price.addEventListener('click', function(){
        window.dataLayer = window.dataLayer || []; 
        window.dataLayer.push({ event: 'file_download', file_name: 'pricelist.pdf' });
      });
    }

    // Simple A/B harness via ?ab=sticky:immediate|dwell
    (function(){
      try {
        var abParam = params.get('ab');
        var key = 'ab_sticky';
        if (abParam && abParam.indexOf('sticky:') === 0) {
          sessionStorage.setItem(key, abParam.split(':')[1]);
        }
        var variant = sessionStorage.getItem(key) || 'immediate';
        window.__ab = { sticky: variant };
      } catch(e) {}
    })();

    // Central contact config (DNI-ready)
    window.__contact = {
      phone: '+1234567890', // DNI provider can rewrite .js-phone hrefs
      whatsapp: 'https://wa.me/1234567890'
    };
    document.querySelectorAll('.js-phone').forEach(function(a){ a.setAttribute('href', 'tel:'+window.__contact.phone.replace(/[^+\d]/g,'')); });
    document.querySelectorAll('.js-wa').forEach(function(a){ a.setAttribute('href', window.__contact.whatsapp); });
  </script>

  <!-- Consent banner (CMv2 simplified) -->
  <div id="cookie-banner">
    This site uses cookies for analytics. Choose your preference.
    <button id="accept-all">Accept all</button>
    <button id="essential-only">Essential only</button>
  </div>

  <script>
    (function(){
      // Web-vitals (LCP/CLS/INP) – lightweight inline loader
      (function(){
        function send(metric){
          if (!__consent.canTrack()) return;
          dataLayer.push({ event: 'web_vital', metric_name: metric.name, value: Math.round(metric.value), element: metric.id || '' });
        }
        var src = 'https://unpkg.com/web-vitals@4/dist/web-vitals.iife.js';
        var s = document.createElement('script'); s.src = src; s.async = true;
        s.onload = function(){
          try {
            webVitals.onLCP(send); webVitals.onCLS(send); webVitals.onINP(send);
          } catch(e) {}
        };
        document.head.appendChild(s);
      })();

      // engaged_10s timer
      setTimeout(function(){ if (__consent.canTrack()) dataLayer.push({ event: 'engaged_10s' }); }, 10000);
      // Push ab_variant on boot
      if (window.__ab && __consent.canTrack()) {
        dataLayer.push({ event: 'ab_variant', test_id: 'sticky', variant: window.__ab.sticky });
      }

      // Sticky CTA bar logic with staffed hours and variants
      var sticky = document.getElementById('sticky-bar');
      function staffedNow(){
        var d = new Date();
        var day = d.getDay(); // 0 Sun - 6 Sat
        var hour = d.getHours();
        var weekday = day >= 1 && day <= 5;
        return weekday && hour >= 8 && hour < 19; // 8:00-18:59
      }
      function showSticky(){
        if (!sticky) return;
        sticky.style.display = 'block';
        sticky.setAttribute('aria-hidden', 'false');
        if (__consent.canTrack()) {
          dataLayer.push({ event: 'cta_view', cta_id: 'sticky_bar' });
        }
      }
      function scheduleSticky(){
        if (!sticky) return;
        if (!staffedNow()) return; // show only in staffed hours
        var v = (window.__ab && window.__ab.sticky) || 'immediate';
        if (v === 'immediate') {
          showSticky();
        } else {
          // dwell variant: after 10s engaged or 50% scroll
          var revealed = false;
          function reveal(){ if (!revealed) { revealed = true; showSticky(); } }
          setTimeout(reveal, 10000);
          window.addEventListener('scroll', function(){
            var sc = window.scrollY + window.innerHeight;
            var perc = sc / document.documentElement.scrollHeight;
            if (perc >= 0.5) reveal();
          }, { passive: true });
        }
      }
      scheduleSticky();

      // Debug overlay toggle via ?debug=1
      var debug = new URLSearchParams(location.search).get('debug') === '1';
      var dbg = document.getElementById('debug-panel');
      var dbgPre = document.getElementById('debug-pre');
      function refreshDebug(){
        if (!dbgPre) return;
        var state = {
          consent: __consent.getConsent(),
          utms: {
            utm_source: sessionStorage.getItem('utm_source') || '',
            utm_medium: sessionStorage.getItem('utm_medium') || '',
            utm_campaign: sessionStorage.getItem('utm_campaign') || '',
            utm_content: sessionStorage.getItem('utm_content') || '',
            utm_term: sessionStorage.getItem('utm_term') || '',
            gclid: sessionStorage.getItem('gclid') || ''
          },
          session_uuid: sessionStorage.getItem('session_uuid') || '',
          ab_sticky: window.__ab && window.__ab.sticky
        };
        dbgPre.textContent = JSON.stringify(state, null, 2);
      }
      if (debug && dbg) { dbg.style.display = 'block'; refreshDebug(); }
      // Push page_boot on load
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        event: 'page_boot',
        page_template: 'single_landing',
        site_env: 'demo_mode',
        session_uuid: sessionStorage.getItem('session_uuid') || ''
      });

      // Form wiring: validation + events + demo vs production submit
      var form = document.getElementById('lead-form');
      var leadModal = document.getElementById('lead-modal');
      // Open buttons
      document.querySelectorAll('[data-cta$="open_form"]').forEach(function(a){
        a.addEventListener('click', function(e){ e.preventDefault(); if (leadModal && leadModal.showModal) { leadModal.showModal(); } });
      });
      var cancelBtn = document.getElementById('lead-cancel');
      if (cancelBtn) cancelBtn.addEventListener('click', function(){ if (leadModal && leadModal.close) leadModal.close(); });

      if (form) {
        var MODE = (new URLSearchParams(location.search).get('mode') || 'demo').toLowerCase();
        var started = false;
        function emit(name, props){
          if (!window.__consent || !__consent.canTrack()) return; // respect consent
          window.dataLayer = window.dataLayer || []; var p = props || {}; p.event = name; dataLayer.push(p);
        }
        function fieldName(el){ return (el && (el.name || el.id)) || 'unknown'; }
        function onStart(){ if (!started) { started = true; emit('form_start', { form_id: 'lead_form' }); } }
        form.addEventListener('input', function(e){ onStart(); var t = e.target; if (!t) return; if (t.name) emit('form_step', { field_name: t.name }); });
        form.addEventListener('change', function(e){ onStart(); var t = e.target; if (!t) return; if (t.name) emit('form_step', { field_name: t.name }); });

        function validate(){
          var required = ['lead_service','lead_city','lead_urgency','lead_phone'];
          var ok = true;
          required.forEach(function(n){
            var el = form.querySelector('[name="'+n+'"]');
            if (!el || !el.value) { ok = false; emit('form_error', { field_name: n, error_type: 'required' }); return; }
            if (n === 'lead_phone') {
              var v = (el.value || '').replace(/\s+/g,'');
              var valid = /^\+?\d{10,15}$/.test(v);
              if (!valid) { ok = false; emit('form_error', { field_name: n, error_type: 'invalid_phone' }); }
            }
          });
          return ok;
        }

        form.addEventListener('submit', function(e){
          e.preventDefault();
          onStart();
          if (!validate()) {
            return;
          }
          // Build payload
          var fd = new FormData(form);
          var payload = {
            lead_name: fd.get('lead_name') || '',
            lead_service: fd.get('lead_service') || '',
            lead_city: fd.get('lead_city') || '',
            lead_urgency: fd.get('lead_urgency') || '',
            lead_phone_hashed: '',
            required_capacity: fd.get('required_capacity') || '',
            job_type: fd.get('job_type') || '',
            lead_budget_estimate: fd.get('lead_budget_estimate') || '',
            lead_notes: fd.get('lead_notes') || '',
            lead_channel: sessionStorage.getItem('utm_source') || 'direct',
            session_uuid: sessionStorage.getItem('session_uuid') || ''
          };
          // Enhanced conversions hashing (consent-bound)
          try {
            if (__consent.canTrack()) {
              var phone = (fd.get('lead_phone') || '').toString().replace(/\D/g,'');
              if (phone) {
                if (window.crypto && window.crypto.subtle) {
                  var enc = new TextEncoder();
                  crypto.subtle.digest('SHA-256', enc.encode(phone)).then(function(buf){
                    var hashArray = Array.from(new Uint8Array(buf));
                    var hashHex = hashArray.map(function(b){ return b.toString(16).padStart(2,'0'); }).join('');
                    payload.lead_phone_hashed = hashHex;
                    emit('generate_lead', payload);
                  });
                } else {
                  emit('generate_lead', payload);
                }
              } else {
                emit('generate_lead', payload);
              }
            }
          } catch(e) {}
          if (MODE === 'prod') {
            // Production: POST to endpoint; still emit events when allowed
            fetch(form.action, { method: 'POST', body: fd, headers: { 'Accept': 'application/json' } })
              .then(function(r){ return r.ok ? r.json().catch(function(){ return {}; }) : Promise.reject(new Error('Submit failed')); })
              .then(function(){
                if (leadModal && leadModal.close) leadModal.close();
                alert('Thank you! We\'ll contact you shortly.');
              })
              .catch(function(){
                alert('Submission failed. Please try again or call us.');
              });
          } else {
            // Demo UX: thank-you
            if (leadModal && leadModal.close) leadModal.close();
            alert('Thank you! We\'ll contact you shortly.');
          }
        });
      }
      var CONSENT_KEY = 'consent_level';
      function getConsent(){ return localStorage.getItem(CONSENT_KEY) || 'essential'; }
      function setConsent(level){ localStorage.setItem(CONSENT_KEY, level); }
      function canTrack(){ return getConsent() === 'all'; }
      function track(eventName, props){
        if (!canTrack()) return;
        window.dataLayer = window.dataLayer || [];
        var payload = props || {}; payload.event = eventName; dataLayer.push(payload);
      }

      // Expose minimal helpers
      window.__consent = { getConsent: getConsent, canTrack: canTrack, track: track };

      // Consent banner controls
      var banner = document.getElementById('cookie-banner');
      var acceptAll = document.getElementById('accept-all');
      var essentialOnly = document.getElementById('essential-only');

      if (getConsent() === 'all') { banner.style.display = 'none'; }

      if (acceptAll) acceptAll.addEventListener('click', function(){
        setConsent('all');
        window.dataLayer = window.dataLayer || [];
        dataLayer.push({ event: 'consent_update', level: 'all' });
        if (window.gtag) {
          gtag('consent', 'update', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
          });
        }
        banner.style.display = 'none';
      });
      if (essentialOnly) essentialOnly.addEventListener('click', function(){
        setConsent('essential');
        window.dataLayer = window.dataLayer || [];
        dataLayer.push({ event: 'consent_update', level: 'essential' });
        if (window.gtag) {
          gtag('consent', 'update', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied'
          });
        }
        banner.style.display = 'none';
      });

      // Footer consent settings reopen
      var reopen = document.getElementById('consent-settings');
      if (reopen) reopen.addEventListener('click', function(e){ e.preventDefault(); banner.style.display = 'block'; });

      // Decorate internal links with stored UTMs/GCLID
      var stored = {}; ['utm_source','utm_medium','utm_campaign','utm_content','utm_term','gclid'].forEach(function(k){
        var v = sessionStorage.getItem(k); if (v) stored[k] = v;
      });
      if (Object.keys(stored).length) {
        var links = document.querySelectorAll('a[href]');
        links.forEach(function(a){
          var href = a.getAttribute('href'); if (!href) return;
          if (href.startsWith('#')) return; // skip anchors
          if (href.startsWith('mailto:') || href.startsWith('tel:')) return;
          if (href.indexOf('wa.me') !== -1) return;
          try {
            var url = new URL(href, location.href);
            if (url.origin !== location.origin && href.startsWith('http')) return; // external
            var changed = false;
            Object.keys(stored).forEach(function(k){ if (!url.searchParams.get(k)) { url.searchParams.set(k, stored[k]); changed = true; } });
            if (changed) a.setAttribute('href', url.pathname + url.search + url.hash);
          } catch(e) { /* ignore invalid */ }
        });
      }

      // Track phone and WhatsApp clicks (respect consent)
      document.querySelectorAll('a[href^="tel:"]').forEach(function(a){
        a.addEventListener('click', function(){
          track('phone_click', { cta_location: a.dataset.cta || a.id || 'unknown' });
        });
      });
      document.querySelectorAll('a[href*="wa.me"]').forEach(function(a){
        a.addEventListener('click', function(){
          // Prefill WA message with context (respect URL length)
          var svc = (document.querySelector('[name="lead_service"]').value || '').slice(0, 32);
          var c = (document.querySelector('[name="lead_city"]').value || '').slice(0, 32);
          var parts = [];
          if (svc) parts.push('Service: '+svc);
          if (c) parts.push('City: '+c);
          var utm = [];
          ['utm_source','utm_medium','utm_campaign'].forEach(function(k){ var v = sessionStorage.getItem(k); if (v) utm.push(k+': '+v); });
          var msg = encodeURIComponent((parts.join(' | ') + (utm.length? (' | '+utm.join(' | ')) : '')).slice(0, 250));
          try {
            var u = new URL(a.href);
            if (!u.searchParams.get('text')) { u.searchParams.set('text', msg); a.href = u.toString(); }
          } catch(e) {}
          track('whatsapp_click', { cta_location: a.dataset.cta || a.id || 'unknown' });
        });
      });

      // Update existing file download hook to respect consent if present
      var priceBtn = document.getElementById('download-price');
      if (priceBtn) {
        priceBtn.addEventListener('click', function(){
          track('file_download', { file_name: 'pricelist.pdf' });
        });
      }

      // FAQ open tracking
      document.querySelectorAll('#faq details').forEach(function(d, i){
        d.addEventListener('toggle', function(){ if (d.open) track('faq_open', { faq_id: 'faq_'+(i+1) }); });
      });

      // scroll_75 tracking
      (function(){
        var fired = false;
        function onScroll(){
          if (fired) return;
          var sc = window.scrollY + window.innerHeight;
          var perc = sc / document.documentElement.scrollHeight;
          if (perc >= 0.75) { fired = true; track('scroll_75'); window.removeEventListener('scroll', onScroll); }
        }
        window.addEventListener('scroll', onScroll, { passive: true });
      })();

      // Estimator logic
      (function(){
        var svc = document.getElementById('est_service');
        var cap = document.getElementById('est_capacity');
        var city = document.getElementById('est_city');
        var btn = document.getElementById('est_calc');
        var use = document.getElementById('est_use');
        var out = document.getElementById('est_result');
        if (!svc || !cap || !city || !btn || !use || !out) return;
        function estimate(){
          var base = svc.value === 'avtokran' ? 80 : 60; // demo hourly price
          var mult = cap.value === 'heavy' ? 1.6 : (cap.value === 'medium' ? 1.2 : 1);
          var low = Math.round(base * mult);
          var high = Math.round(low * 1.3);
          out.textContent = 'Estimated '+low+'–'+high+' USD / hour (rough)';
          if (__consent.canTrack()) dataLayer.push({ event: 'form_step', field_name: 'estimator_calc' });
        }
        btn.addEventListener('click', function(){ estimate(); });
        document.querySelectorAll('#estimator [data-spec]').forEach(function(b){ b.addEventListener('click', function(){ cap.value = b.getAttribute('data-spec'); estimate(); if (__consent.canTrack()) dataLayer.push({ event: 'spec_select', value: cap.value }); }); });
        use.addEventListener('click', function(){
          var form = document.getElementById('lead-form'); if (!form) return;
          var fsvc = form.querySelector('[name="lead_service"]');
          var fcity = form.querySelector('[name="lead_city"]');
          var fcap = form.querySelector('[name="required_capacity"]');
          if (fsvc) fsvc.value = svc.value;
          if (fcity && city.value) fcity.value = city.value;
          if (fcap) fcap.value = cap.value;
          if (__consent.canTrack()) dataLayer.push({ event: 'form_step', field_name: 'estimator_use' });
          location.hash = '#lead';
        });
      })();

      // Phase 15: Proof clicks
      document.querySelectorAll('.proof-link').forEach(function(a){ a.addEventListener('click', function(e){ e.preventDefault(); if (__consent.canTrack()) dataLayer.push({ event: 'proof_click', proof_id: a.dataset.proofId || 'unknown' }); }); });
      // Phase 9: Experiments router
      (function(){
        var experiments = { sticky: { id: 'sticky', variants: { immediate: 50, dwell: 50 } },
                            form_copy: { id: 'form_copy', variants: { a: 50, b: 50 } } };
        function assign(name){
          var key = 'ab_'+name; var existing = sessionStorage.getItem(key); if (existing) return existing;
          var roll = Math.random()*100, acc = 0, pick = 'a';
          var weights = experiments[name].variants; Object.keys(weights).some(function(v){ acc += weights[v]; if (roll <= acc) { pick = v; return true; } return false; });
          sessionStorage.setItem(key, pick); return pick;
        }
        Object.keys(experiments).forEach(function(n){ assign(n); });
        // snapshot to hidden field
        var snap = {}; Object.keys(experiments).forEach(function(n){ snap[n] = sessionStorage.getItem('ab_'+n); });
        var abEl = document.getElementById('ab_assignments'); if (abEl) abEl.value = JSON.stringify(snap);
        if (__consent.canTrack()) { Object.keys(snap).forEach(function(n){ dataLayer.push({ event: 'ab_variant', test_id: n, variant: snap[n] }); }); }
      })();

      // Phase 10: UTM preflight (dev/preview only)
      (function(){
        var host = location.hostname;
        var isPreview = host.endsWith('github.io') || host==='localhost';
        if (!isPreview) return;
        function sanitize(k, v){ if (!v) return v; v = v.trim(); if (k==='utm_source' || k==='utm_medium') v = v.toLowerCase(); return v.replace(/[^a-zA-Z0-9_\-\.\s]/g, ''); }
        var required = ['utm_source','utm_medium','utm_campaign'];
        var missing = required.filter(function(k){ return !(sessionStorage.getItem(k) || params.get(k)); });
        required.forEach(function(k){ var val = sessionStorage.getItem(k) || params.get(k) || ''; var s = sanitize(k, val); if (s !== val) console.warn('[UTM sanitize]', k, '=>', s); });
        if (missing.length) { console.warn('[UTM check] Missing:', missing.join(', ')); } else { console.log('%c[UTM check] OK','color:#2bbf87'); }
      })();

      // Phase 12: Performance budget (coach mode)
      (function(){
        var host = location.hostname; var isPreview = host.endsWith('github.io') || host==='localhost'; if (!isPreview) return;
        function warn(label, cond){ if (cond) console.warn('[Perf budget]', label); }
        // Rough content lengths (uncompressed) as heuristic
        try {
          var htmlSize = document.documentElement.outerHTML.length;
          warn('HTML > 100KB', htmlSize > 100*1024);
        } catch(e) {}
        // Main-thread blocking approx
        try {
          var longTasks = 0; new PerformanceObserver(function(list){ list.getEntries().forEach(function(e){ if (e.duration > 50) longTasks += e.duration; }); setTimeout(function(){ warn('Main-thread blocking > 200ms', longTasks > 200); }, 3000); }).observe({ entryTypes: ['longtask'] });
        } catch(e) {}
      })();

      // Phase 13: Ops guardrails (throttle repeated call clicks)
      (function(){
        var lastCall = 0; function now(){ return Date.now(); }
        document.querySelectorAll('.js-phone').forEach(function(a){ a.addEventListener('click', function(){
          var t = now(); if (t - lastCall < 2*60*1000) { // clicked twice within 2 min
            var sticky = document.getElementById('sticky-bar'); if (sticky) { sticky.style.display = 'none'; setTimeout(function(){ if (sticky) sticky.style.display = 'block'; }, 20*60*1000); }
          }
          lastCall = t;
        }); });
      })();

      // Phase 14: Debug overlay v2 – dataLayer tail
      (function(){
        var debug = new URLSearchParams(location.search).get('debug') === '1'; if (!debug) return;
        var log = []; var origPush = dataLayer.push; dataLayer.push = function(){ var ev = arguments[0]; if (log.length > 9) log.shift(); log.push(ev); try { origPush.apply(dataLayer, arguments); } catch(e) {} refresh(); };
        function refresh(){ var el = document.getElementById('debug-pre'); if (!el) return; var payload = { consent: __consent.getConsent(), utms: { utm_source: sessionStorage.getItem('utm_source')||'', utm_medium: sessionStorage.getItem('utm_medium')||'', utm_campaign: sessionStorage.getItem('utm_campaign')||'' }, session_uuid: sessionStorage.getItem('session_uuid')||'', experiments: (function(){ var o={}; ['sticky','form_copy'].forEach(function(n){ o[n]=sessionStorage.getItem('ab_'+n); }); return o; })(), last_events: log }; el.textContent = JSON.stringify(payload, null, 2); }
        refresh();
      })();

      // Security/Privacy: Forget me button clears storage and resets consent
      (function(){
        var btn = document.getElementById('forget-me'); if (!btn) return;
        btn.addEventListener('click', function(){
          try {
            ['utm_source','utm_medium','utm_campaign','utm_content','utm_term','gclid','session_uuid','ab_sticky','ab_form_copy'].forEach(function(k){ sessionStorage.removeItem(k); localStorage.removeItem(k); });
            localStorage.removeItem('consent_level');
            alert('Your session has been cleared.');
            location.reload();
          } catch(e) { location.reload(); }
        });
      })();
    })();
  </script>
  <!-- External modules (progressive refactor) -->
  <script src="assets/js/id.js"></script>
  <script src="assets/js/utm-guard.js"></script>
  <script src="assets/js/exp.js"></script>
  <script src="assets/js/perf-budget.js"></script>
  <script src="assets/js/store-geo.js"></script>
  <script src="assets/js/inventory.js"></script>
  <script src="assets/js/crm-hooks.js"></script>
  <script src="assets/js/privacy.js"></script>
  <script src="assets/js/modules/cro.js"></script>
  <script src="assets/js/debug.js"></script>
  <script src="assets/js/ops.js"></script>
</body>
</html>
